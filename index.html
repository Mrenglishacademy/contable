<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gente de Hoy Contables</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #18bc9c;
            --danger-color: #e74a3b;
            --dark-color: #5a5c69;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fc;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            background: white;
        }
        
        .sidebar {
            background: linear-gradient(180deg, var(--primary-color) 10%, #1a252f 100%);
            min-height: 100vh;
            transition: all 0.3s;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 1rem;
            margin: 0.2rem 0;
            border-radius: 0.35rem;
        }
        
        .sidebar .nav-link:hover {
            color: #fff;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .sidebar .nav-link.active {
            color: #fff;
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .sidebar .nav-link i {
            margin-right: 0.5rem;
        }
        
        .topbar {
            height: 4.375rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        }
        
        .card {
            border: none;
            border-radius: 0.35rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-success {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        .invoice-item-row {
            transition: all 0.3s;
        }
        
        .invoice-item-row:hover {
            background-color: #f8f9fa;
        }
        
        .logo-text {
            font-weight: 800;
            font-size: 1.5rem;
            color: white;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.8);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }
        
        .tutorial-content {
            max-width: 600px;
            padding: 30px;
            background: var(--primary-color);
            border-radius: 10px;
            position: relative;
        }
        
        .tutorial-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-container">
        <div class="text-center mb-4">
            <h2><i class="bi bi-building"></i> Gente de Hoy Contables</h2>
            <p class="text-muted">Sistema de Facturación Integral</p>
        </div>
        <form id="login-form">
            <div class="mb-3">
                <label for="username" class="form-label">Usuario</label>
                <input type="text" class="form-control" id="username" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Contraseña</label>
                <input type="password" class="form-control" id="password" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-box-arrow-in-right"></i> Ingresar
            </button>
        </form>
    </div>

    <!-- Main App (Hidden until login) -->
    <div id="main-app" style="display: none;">
        <div class="d-flex">
            <!-- Sidebar -->
            <div class="sidebar col-md-3 col-lg-2 p-0">
                <div class="px-3 py-4">
                    <div class="logo-text mb-4 text-center">
                        <i class="bi bi-building"></i> Gente Hoy
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                                <i class="bi bi-speedometer2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('facturas')">
                                <i class="bi bi-file-earmark-text"></i> Facturas
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('clientes')">
                                <i class="bi bi-people"></i> Clientes
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('productos')">
                                <i class="bi bi-box-seam"></i> Productos
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('reportes')">
                                <i class="bi bi-bar-chart"></i> Reportes
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('configuracion')">
                                <i class="bi bi-gear"></i> Configuración
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <div class="flex-grow-1">
                <!-- Topbar -->
                <nav class="navbar topbar navbar-expand navbar-light bg-white shadow mb-4">
                    <div class="container-fluid">
                        <button class="btn btn-link d-md-none rounded-circle mr-3" onclick="toggleSidebar()">
                            <i class="bi bi-list"></i>
                        </button>

                        <div class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
                            <div class="input-group">
                                <input type="text" class="form-control bg-light border-0 small" placeholder="Buscar..." aria-label="Search">
                                <div class="input-group-append">
                                    <button class="btn btn-primary" type="button">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item dropdown no-arrow mx-1">
                                <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button" data-bs-toggle="dropdown">
                                    <i class="bi bi-bell"></i>
                                    <span class="badge bg-danger badge-counter">3+</span>
                                </a>
                            </li>

                            <li class="nav-item dropdown no-arrow mx-1">
                                <a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button" data-bs-toggle="dropdown">
                                    <i class="bi bi-envelope"></i>
                                    <span class="badge bg-danger badge-counter">7</span>
                                </a>
                            </li>

                            <div class="topbar-divider d-none d-sm-block"></div>

                            <li class="nav-item dropdown no-arrow">
                                <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                                    <span class="mr-2 d-none d-lg-inline text-gray-600 small" id="logged-user">Admin</span>
                                    <img class="img-profile rounded-circle" src="https://source.unsplash.com/QAB-WJcbgJk/60x60" width="32" height="32">
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#"><i class="bi bi-person"></i> Perfil</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="bi bi-gear"></i> Configuración</a></li>
                                    <div class="dropdown-divider"></div>
                                    <li><a class="dropdown-item" href="#" onclick="logout()"><i class="bi bi-box-arrow-right"></i> Cerrar Sesión</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </nav>

                <!-- Content Sections -->
                <div class="container-fluid">
                    <!-- Dashboard Section -->
                    <div id="dashboard" class="content-section active">
                        <div class="d-sm-flex align-items-center justify-content-between mb-4">
                            <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
                            <button class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" onclick="exportToPDF('dashboard-content', 'Dashboard.pdf')">
                                <i class="bi bi-download text-white-50"></i> Exportar PDF
                            </button>
                        </div>

                        <div id="dashboard-content">
                            <div class="row">
                                <div class="col-xl-3 col-md-6 mb-4">
                                    <div class="card border-left-primary shadow h-100 py-2">
                                        <div class="card-body">
                                            <div class="row no-gutters align-items-center">
                                                <div class="col mr-2">
                                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                                        Facturas (Mes)</div>
                                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="month-invoices">$40,000</div>
                                                </div>
                                                <div class="col-auto">
                                                    <i class="bi bi-receipt text-gray-300" style="font-size: 2rem;"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-3 col-md-6 mb-4">
                                    <div class="card border-left-success shadow h-100 py-2">
                                        <div class="card-body">
                                            <div class="row no-gutters align-items-center">
                                                <div class="col mr-2">
                                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                        Clientes</div>
                                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-clients">215</div>
                                                </div>
                                                <div class="col-auto">
                                                    <i class="bi bi-people text-gray-300" style="font-size: 2rem;"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-3 col-md-6 mb-4">
                                    <div class="card border-left-info shadow h-100 py-2">
                                        <div class="card-body">
                                            <div class="row no-gutters align-items-center">
                                                <div class="col mr-2">
                                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                                        Productos</div>
                                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-products">1,245</div>
                                                </div>
                                                <div class="col-auto">
                                                    <i class="bi bi-box-seam text-gray-300" style="font-size: 2rem;"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-3 col-md-6 mb-4">
                                    <div class="card border-left-warning shadow h-100 py-2">
                                        <div class="card-body">
                                            <div class="row no-gutters align-items-center">
                                                <div class="col mr-2">
                                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                        Pendientes</div>
                                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="pending-invoices">18</div>
                                                </div>
                                                <div class="col-auto">
                                                    <i class="bi bi-exclamation-triangle text-gray-300" style="font-size: 2rem;"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6 mb-4">
                                    <div class="card shadow mb-4">
                                        <div class="card-header py-3">
                                            <h6 class="m-0 font-weight-bold text-primary">Ventas Recientes</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-bordered" width="100%" cellspacing="0">
                                                    <thead>
                                                        <tr>
                                                            <th># Factura</th>
                                                            <th>Cliente</th>
                                                            <th>Estado</th>
                                                            <th>Total</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="recent-invoices">
                                                        <!-- Dinamic content -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6 mb-4">
                                    <div class="card shadow mb-4">
                                        <div class="card-header py-3">
                                            <h6 class="m-0 font-weight-bold text-primary">Gráfico de Ventas</h6>
                                        </div>
                                        <div class="card-body">
                                            <canvas id="salesChart" height="200"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Facturas Section -->
                    <div id="facturas" class="content-section">
                        <div class="d-sm-flex align-items-center justify-content-between mb-4">
                            <h1 class="h3 mb-0 text-gray-800">Facturas</h1>
                            <div>
                                <button class="btn btn-sm btn-success me-2" onclick="exportToExcel('invoices-table', 'Facturas.xlsx')">
                                    <i class="bi bi-file-earmark-excel"></i> Exportar Excel
                                </button>
                                <button class="btn btn-sm btn-primary shadow-sm" onclick="showCreateInvoice()">
                                    <i class="bi bi-plus text-white-50"></i> Crear Factura
                                </button>
                            </div>
                        </div>

                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                <h6 class="m-0 font-weight-bold text-primary">Listado de Facturas</h6>
                                <div class="dropdown no-arrow">
                                    <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown">
                                        <i class="bi bi-three-dots-vertical text-gray-400"></i>
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        <li><a class="dropdown-item" href="#" onclick="exportToPDF('invoices-table', 'Facturas.pdf')">Exportar PDF</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="exportToExcel('invoices-table', 'Facturas.xlsx')">Exportar Excel</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="printElement('invoices-table')">Imprimir</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="invoices-table" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>Número</th>
                                                <th>Cliente</th>
                                                <th>Fecha</th>
                                                <th>Vencimiento</th>
                                                <th>Total</th>
                                                <th>Estado</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="invoices-list">
                                            <!-- Dinamic content -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Create Invoice Section (Hidden by default) -->
                    <div id="create-invoice" class="content-section">
                        <div class="d-sm-flex align-items-center justify-content-between mb-4">
                            <h1 class="h3 mb-0 text-gray-800">Nueva Factura</h1>
                            <div>
                                <button class="btn btn-secondary me-2" onclick="showSection('facturas')">
                                    <i class="bi bi-arrow-left"></i> Volver
                                </button>
                                <button class="btn btn-success me-2" onclick="saveInvoice()">
                                    <i class="bi bi-save"></i> Guardar
                                </button>
                                <button class="btn btn-primary" onclick="printInvoice()">
                                    <i class="bi bi-printer"></i> Imprimir
                                </button>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Detalles de Factura</h6>
                                    </div>
                                    <div class="card-body">
                                        <form id="invoice-form">
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="invoiceNumber" class="form-label">Número de Factura</label>
                                                    <input type="text" class="form-control" id="invoiceNumber" readonly>
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="invoiceDate" class="form-label">Fecha</label>
                                                    <input type="date" class="form-control" id="invoiceDate">
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="dueDate" class="form-label">Fecha de Vencimiento</label>
                                                    <input type="date" class="form-control" id="dueDate">
                                                </div>
                                                <div class="col-md-6">
                                                    <label for="paymentTerms" class="form-label">Términos de Pago</label>
                                                    <select class="form-select" id="paymentTerms">
                                                        <option value="0">Contado</option>
                                                        <option value="15" selected>15 días</option>
                                                        <option value="30">30 días</option>
                                                        <option value="60">60 días</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="clientSelect" class="form-label">Cliente</label>
                                                <select class="form-select" id="clientSelect" required>
                                                    <option value="" selected disabled>Seleccionar cliente...</option>
                                                    <!-- Dinamic content -->
                                                </select>
                                            </div>
                                        </form>
                                    </div>
                                </div>

                                <div class="card shadow mb-4">
                                    <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                        <h6 class="m-0 font-weight-bold text-primary">Productos/Servicios</h6>
                                        <button class="btn btn-sm btn-primary" onclick="addInvoiceItem()">
                                            <i class="bi bi-plus"></i> Agregar
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table" id="invoiceItemsTable">
                                                <thead>
                                                    <tr>
                                                        <th>Producto</th>
                                                        <th width="100">Cantidad</th>
                                                        <th width="120">Precio</th>
                                                        <th width="120">Descuento</th>
                                                        <th width="120">Total</th>
                                                        <th width="50"></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Dinamic content -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Resumen</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="notes" class="form-label">Notas</label>
                                            <textarea class="form-control" id="notes" rows="3"></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="terms" class="form-label">Términos y Condiciones</label>
                                            <textarea class="form-control" id="terms" rows="3">Pago dentro de 15 días</textarea>
                                        </div>
                                        <hr>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Subtotal:</span>
                                            <span id="subtotal">$0.00</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Descuento:</span>
                                            <span id="totalDiscount">$0.00</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Impuestos (<span id="taxRateLabel">19</span>%):</span>
                                            <span id="taxes">$0.00</span>
                                        </div>
                                        <div class="d-flex justify-content-between fw-bold">
                                            <span>Total:</span>
                                            <span id="invoiceTotal">$0.00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Clientes Section -->
                    <div id="clientes" class="content-section">
                        <div class="d-sm-flex align-items-center justify-content-between mb-4">
                            <h1 class="h3 mb-0 text-gray-800">Clientes</h1>
                            <div>
                                <button class="btn btn-sm btn-success me-2" onclick="exportToExcel('clients-table', 'Clientes.xlsx')">
                                    <i class="bi bi-file-earmark-excel"></i> Exportar Excel
                                </button>
                                <button class="btn btn-sm btn-primary shadow-sm" onclick="showNewClientModal()">
                                    <i class="bi bi-plus text-white-50"></i> Nuevo Cliente
                                </button>
                            </div>
                        </div>

                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold text-primary">Listado de Clientes</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="clients-table" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Nombre</th>
                                                <th>Identificación</th>
                                                <th>Teléfono</th>
                                                <th>Email</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="clients-list">
                                            <!-- Dinamic content -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- New Client Modal -->
                    <div class="modal fade" id="newClientModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Nuevo Cliente</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="client-form">
                                        <div class="mb-3">
                                            <label for="clientName" class="form-label">Nombre Completo</label>
                                            <input type="text" class="form-control" id="clientName" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="clientId" class="form-label">Identificación</label>
                                            <input type="text" class="form-control" id="clientId" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="clientPhone" class="form-label">Teléfono</label>
                                            <input type="tel" class="form-control" id="clientPhone">
                                        </div>
                                        <div class="mb-3">
                                            <label for="clientEmail" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="clientEmail">
                                        </div>
                                        <div class="mb-3">
                                            <label for="clientAddress" class="form-label">Dirección</label>
                                            <textarea class="form-control" id="clientAddress" rows="2"></textarea>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="button" class="btn btn-primary" onclick="saveClient()">Guardar Cliente</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Productos Section -->
                    <div id="productos" class="content-section">
                        <div class="d-sm-flex align-items-center justify-content-between mb-4">
                            <h1 class="h3 mb-0 text-gray-800">Productos</h1>
                            <div>
                                <button class="btn btn-sm btn-success me-2" onclick="exportToExcel('products-table', 'Productos.xlsx')">
                                    <i class="bi bi-file-earmark-excel"></i> Exportar Excel
                                </button>
                                <button class="btn btn-sm btn-primary shadow-sm" onclick="showNewProductModal()">
                                    <i class="bi bi-plus text-white-50"></i> Nuevo Producto
                                </button>
                            </div>
                        </div>

                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold text-primary">Listado de Productos</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="products-table" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>Código</th>
                                                <th>Nombre</th>
                                                <th>Categoría</th>
                                                <th>Precio</th>
                                                <th>Stock</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="products-list">
                                            <!-- Dinamic content -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- New Product Modal -->
                    <div class="modal fade" id="newProductModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Nuevo Producto</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="product-form">
                                        <div class="mb-3">
                                            <label for="productCode" class="form-label">Código</label>
                                            <input type="text" class="form-control" id="productCode" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="productName" class="form-label">Nombre</label>
                                            <input type="text" class="form-control" id="productName" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="productCategory" class="form-label">Categoría</label>
                                            <input type="text" class="form-control" id="productCategory">
                                        </div>
                                        <div class="mb-3">
                                            <label for="productPrice" class="form-label">Precio</label>
                                            <input type="number" class="form-control" id="productPrice" min="0" step="0.01" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="productStock" class="form-label">Stock</label>
                                            <input type="number" class="form-control" id="productStock" min="0" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="productDescription" class="form-label">Descripción</label>
                                            <textarea class="form-control" id="productDescription" rows="2"></textarea>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="button" class="btn btn-primary" onclick="saveProduct()">Guardar Producto</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reportes Section -->
                    <div id="reportes" class="content-section">
                        <div class="d-sm-flex align-items-center justify-content-between mb-4">
                            <h1 class="h3 mb-0 text-gray-800">Reportes</h1>
                            <div>
                                <button class="btn btn-sm btn-success me-2" onclick="exportToExcel('reports-content', 'Reportes.xlsx')">
                                    <i class="bi bi-file-earmark-excel"></i> Exportar Excel
                                </button>
                                <button class="btn btn-sm btn-primary shadow-sm" onclick="exportToPDF('reports-content', 'Reportes.pdf')">
                                    <i class="bi bi-download text-white-50"></i> Exportar PDF
                                </button>
                            </div>
                        </div>

                        <div id="reports-content">
                            <div class="row">
                                <div class="col-lg-6 mb-4">
                                    <div class="card shadow mb-4">
                                        <div class="card-header py-3">
                                            <h6 class="m-0 font-weight-bold text-primary">Ventas por Mes</h6>
                                        </div>
                                        <div class="card-body">
                                            <canvas id="monthlySalesChart" height="200"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 mb-4">
                                    <div class="card shadow mb-4">
                                        <div class="card-header py-3">
                                            <h6 class="m-0 font-weight-bold text-primary">Productos Más Vendidos</h6>
                                        </div>
                                        <div class="card-body">
                                            <canvas id="topProductsChart" height="200"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="card shadow mb-4">
                                        <div class="card-header py-3">
                                            <h6 class="m-0 font-weight-bold text-primary">Resumen Anual</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-bordered" width="100%" cellspacing="0">
                                                    <thead>
                                                        <tr>
                                                            <th>Mes</th>
                                                            <th>Facturas</th>
                                                            <th>Ventas Totales</th>
                                                            <th>Clientes Nuevos</th>
                                                            <th>Productos Vendidos</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="annual-report">
                                                        <!-- Dinamic content -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Configuración Section -->
                    <div id="configuracion" class="content-section">
                        <div class="d-sm-flex align-items-center justify-content-between mb-4">
                            <h1 class="h3 mb-0 text-gray-800">Configuración</h1>
                        </div>

                        <div class="row">
                            <div class="col-lg-6">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Información de la Empresa</h6>
                                    </div>
                                    <div class="card-body">
                                        <form id="company-form">
                                            <div class="mb-3">
                                                <label for="companyName" class="form-label">Nombre de la Empresa</label>
                                                <input type="text" class="form-control" id="companyName" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="nit" class="form-label">NIT/RUT</label>
                                                <input type="text" class="form-control" id="nit" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="address" class="form-label">Dirección</label>
                                                <input type="text" class="form-control" id="address" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="phone" class="form-label">Teléfono</label>
                                                <input type="text" class="form-control" id="phone" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="email" class="form-label">Email</label>
                                                <input type="email" class="form-control" id="email" required>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Configuración de Facturación</h6>
                                    </div>
                                    <div class="card-body">
                                        <form id="billing-form">
                                            <div class="mb-3">
                                                <label for="invoicePrefix" class="form-label">Prefijo de Facturas</label>
                                                <input type="text" class="form-control" id="invoicePrefix" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="nextInvoiceNumber" class="form-label">Siguiente Número</label>
                                                <input type="number" class="form-control" id="nextInvoiceNumber" min="1" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="taxRate" class="form-label">Tasa de Impuesto (%)</label>
                                                <input type="number" class="form-control" id="taxRate" min="0" max="100" step="0.01" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="currency" class="form-label">Moneda</label>
                                                <select class="form-select" id="currency" required>
                                                    <option value="COP" selected>Peso Colombiano (COP)</option>
                                                    <option value="USD">Dólar Americano (USD)</option>
                                                    <option value="EUR">Euro (EUR)</option>
                                                </select>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tutorial Overlay -->
    <div id="tutorial-overlay" class="tutorial-overlay" style="display: none;">
        <div class="tutorial-content">
            <h3 id="tutorial-title">Bienvenido a Gente de Hoy Contables</h3>
            <p id="tutorial-text">Este breve tutorial te guiará por las principales funciones del sistema.</p>
            <div class="tutorial-nav">
                <button class="btn btn-secondary" id="prev-tutorial" disabled>Anterior</button>
                <button class="btn btn-primary" id="next-tutorial">Siguiente</button>
                <button class="btn btn-success" id="skip-tutorial" style="display: none;">Comenzar</button>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // =============================================
        // DATOS DE LA APLICACIÓN
        // =============================================
        let appData = {
            currentUser: null,
            clients: [
                { id: 1, name: "Cliente Ejemplo 1", identification: "123456789", phone: "3001234567", email: "cliente1@ejemplo.com", address: "Calle 123 #45-67" },
                { id: 2, name: "Cliente Ejemplo 2", identification: "987654321", phone: "3107654321", email: "cliente2@ejemplo.com", address: "Carrera 89 #12-34" }
            ],
            products: [
                { id: 1, code: "PROD-001", name: "Producto Ejemplo 1", category: "Categoría 1", price: 50.00, stock: 100, description: "Descripción del producto 1" },
                { id: 2, code: "PROD-002", name: "Producto Ejemplo 2", category: "Categoría 2", price: 75.00, stock: 50, description: "Descripción del producto 2" }
            ],
            invoices: [
                { 
                    id: 1, 
                    number: "INV-2023-001", 
                    date: "2023-05-15", 
                    dueDate: "2023-06-15", 
                    clientId: 1, 
                    items: [
                        { productId: 1, quantity: 2, price: 50.00, discount: 0 }
                    ], 
                    notes: "", 
                    terms: "Pago dentro de 15 días", 
                    status: "paid", 
                    total: 100.00 
                },
                { 
                    id: 2, 
                    number: "INV-2023-002", 
                    date: "2023-05-18", 
                    dueDate: "2023-06-18", 
                    clientId: 2, 
                    items: [
                        { productId: 2, quantity: 1, price: 75.00, discount: 0 }
                    ], 
                    notes: "", 
                    terms: "Pago dentro de 15 días", 
                    status: "pending", 
                    total: 75.00 
                }
            ],
            settings: {
                companyName: "Mi Empresa S.A.S.",
                nit: "123456789-0",
                address: "Calle 123 #45-67",
                phone: "+57 1234567890",
                email: "contacto@miempresa.com",
                invoicePrefix: "INV",
                nextInvoiceNumber: 3,
                taxRate: 19,
                currency: "COP"
            }
        };

        // =============================================
        // FUNCIONES DE LA APLICACIÓN
        // =============================================
        
        // Inicialización de la aplicación
        function initApp() {
            // Verificar si hay datos en localStorage
            const savedData = localStorage.getItem('facturacionData');
            if(savedData) {
                appData = JSON.parse(savedData);
            }
            
            // Configurar eventos
            setupEventListeners();
            
            // Mostrar pantalla de login
            showLoginScreen();
        }
        
        // Mostrar pantalla de login
        function showLoginScreen() {
            document.getElementById('login-screen').style.display = 'block';
            document.getElementById('main-app').style.display = 'none';
            
            // Limpiar formulario
            document.getElementById('login-form').reset();
        }
        
        // Mostrar aplicación principal
        function showMainApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            
            // Cargar datos
            loadDashboardData();
            loadClients();
            loadProducts();
            loadInvoices();
            loadSettings();
            
            // Mostrar dashboard por defecto
            showSection('dashboard');
            
            // Verificar si es la primera vez que ingresa
            const firstTime = localStorage.getItem('firstTime') === null;
            if(firstTime) {
                showTutorial();
                localStorage.setItem('firstTime', 'false');
            }
        }
        
        // Cerrar sesión
        function logout() {
            appData.currentUser = null;
            showLoginScreen();
        }
        
        // Mostrar sección seleccionada
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            const section = document.getElementById(sectionId);
            if(section) {
                section.classList.add('active');
                
                // Actualizar datos según la sección
                switch(sectionId) {
                    case 'dashboard':
                        loadDashboardData();
                        break;
                    case 'facturas':
                        loadInvoices();
                        break;
                    case 'clientes':
                        loadClients();
                        break;
                    case 'productos':
                        loadProducts();
                        break;
                    case 'reportes':
                        loadReports();
                        break;
                }
            }
        }
        
        // Alternar sidebar en móviles
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.style.display = sidebar.style.display === 'none' ? 'block' : 'none';
        }
        
        // =============================================
        // FUNCIONES DE DATOS
        // =============================================
        
        // Cargar datos del dashboard
        function loadDashboardData() {
            // Calcular total de facturas del mes
            const currentMonth = new Date().getMonth();
            const monthInvoices = appData.invoices.filter(inv => {
                const invMonth = new Date(inv.date).getMonth();
                return invMonth === currentMonth;
            });
            
            const monthTotal = monthInvoices.reduce((sum, inv) => sum + inv.total, 0);
            document.getElementById('month-invoices').textContent = `$${monthTotal.toFixed(2)}`;
            
            // Mostrar total de clientes
            document.getElementById('total-clients').textContent = appData.clients.length;
            
            // Mostrar total de productos
            document.getElementById('total-products').textContent = appData.products.length;
            
            // Mostrar facturas pendientes
            const pendingInvoices = appData.invoices.filter(inv => inv.status === 'pending');
            document.getElementById('pending-invoices').textContent = pendingInvoices.length;
            
            // Mostrar facturas recientes
            const recentInvoicesTable = document.getElementById('recent-invoices');
            recentInvoicesTable.innerHTML = '';
            
            const recentInvoices = [...appData.invoices].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 3);
            recentInvoices.forEach(inv => {
                const client = appData.clients.find(c => c.id === inv.clientId);
                const statusBadge = inv.status === 'paid' ? 
                    '<span class="badge bg-success">Pagada</span>' : 
                    '<span class="badge bg-warning text-dark">Pendiente</span>';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${inv.number}</td>
                    <td>${client ? client.name : 'Cliente no encontrado'}</td>
                    <td>${statusBadge}</td>
                    <td>$${inv.total.toFixed(2)}</td>
                `;
                recentInvoicesTable.appendChild(row);
            });
            
            // Inicializar gráficos
            initDashboardCharts();
        }
        
        // Cargar clientes
        function loadClients() {
            const clientsTable = document.getElementById('clients-list');
            clientsTable.innerHTML = '';
            
            appData.clients.forEach(client => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${client.id}</td>
                    <td>${client.name}</td>
                    <td>${client.identification}</td>
                    <td>${client.phone}</td>
                    <td>${client.email}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="viewClient(${client.id})"><i class="bi bi-eye"></i></button>
                        <button class="btn btn-sm btn-info" onclick="editClient(${client.id})"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="deleteClient(${client.id})"><i class="bi bi-trash"></i></button>
                    </td>
                `;
                clientsTable.appendChild(row);
            });
            
            // Actualizar select de clientes en facturas
            const clientSelect = document.getElementById('clientSelect');
            clientSelect.innerHTML = '<option value="" selected disabled>Seleccionar cliente...</option>';
            appData.clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = client.name;
                clientSelect.appendChild(option);
            });
        }
        
        // Cargar productos
        function loadProducts() {
            const productsTable = document.getElementById('products-list');
            productsTable.innerHTML = '';
            
            appData.products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.code}</td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>$${product.price.toFixed(2)}</td>
                    <td>${product.stock}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="viewProduct(${product.id})"><i class="bi bi-eye"></i></button>
                        <button class="btn btn-sm btn-info" onclick="editProduct(${product.id})"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})"><i class="bi bi-trash"></i></button>
                    </td>
                `;
                productsTable.appendChild(row);
            });
        }
        
        // Cargar facturas
        function loadInvoices() {
            const invoicesTable = document.getElementById('invoices-list');
            invoicesTable.innerHTML = '';
            
            appData.invoices.forEach(invoice => {
                const client = appData.clients.find(c => c.id === invoice.clientId);
                const statusBadge = invoice.status === 'paid' ? 
                    '<span class="badge bg-success">Pagada</span>' : 
                    '<span class="badge bg-warning text-dark">Pendiente</span>';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${invoice.number}</td>
                    <td>${client ? client.name : 'Cliente no encontrado'}</td>
                    <td>${formatDate(invoice.date)}</td>
                    <td>${formatDate(invoice.dueDate)}</td>
                    <td>$${invoice.total.toFixed(2)}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="viewInvoice(${invoice.id})"><i class="bi bi-eye"></i></button>
                        <button class="btn btn-sm btn-info" onclick="editInvoice(${invoice.id})"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="deleteInvoice(${invoice.id})"><i class="bi bi-trash"></i></button>
                    </td>
                `;
                invoicesTable.appendChild(row);
            });
        }
        
        // Cargar reportes
        function loadReports() {
            // Inicializar gráficos de reportes
            initReportCharts();
            
            // Generar reporte anual
            const annualReport = document.getElementById('annual-report');
            annualReport.innerHTML = '';
            
            const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            
            for(let i = 0; i < 6; i++) { // Mostrar últimos 6 meses
                const monthInvoices = appData.invoices.filter(inv => {
                    const invMonth = new Date(inv.date).getMonth();
                    return invMonth === i;
                });
                
                const monthTotal = monthInvoices.reduce((sum, inv) => sum + inv.total, 0);
                const monthClients = [...new Set(monthInvoices.map(inv => inv.clientId))].length;
                const monthProducts = monthInvoices.reduce((sum, inv) => sum + inv.items.length, 0);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${months[i]}</td>
                    <td>${monthInvoices.length}</td>
                    <td>$${monthTotal.toFixed(2)}</td>
                    <td>${monthClients}</td>
                    <td>${monthProducts}</td>
                `;
                annualReport.appendChild(row);
            }
        }
        
        // Cargar configuración
        function loadSettings() {
            document.getElementById('companyName').value = appData.settings.companyName;
            document.getElementById('nit').value = appData.settings.nit;
            document.getElementById('address').value = appData.settings.address;
            document.getElementById('phone').value = appData.settings.phone;
            document.getElementById('email').value = appData.settings.email;
            document.getElementById('invoicePrefix').value = appData.settings.invoicePrefix;
            document.getElementById('nextInvoiceNumber').value = appData.settings.nextInvoiceNumber;
            document.getElementById('taxRate').value = appData.settings.taxRate;
            document.getElementById('currency').value = appData.settings.currency;
            
            // Actualizar etiqueta de tasa de impuesto
            document.getElementById('taxRateLabel').textContent = appData.settings.taxRate;
        }
        
        // Guardar configuración
        function saveSettings() {
            appData.settings = {
                companyName: document.getElementById('companyName').value,
                nit: document.getElementById('nit').value,
                address: document.getElementById('address').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                invoicePrefix: document.getElementById('invoicePrefix').value,
                nextInvoiceNumber: parseInt(document.getElementById('nextInvoiceNumber').value),
                taxRate: parseFloat(document.getElementById('taxRate').value),
                currency: document.getElementById('currency').value
            };
            
            // Actualizar etiqueta de tasa de impuesto
            document.getElementById('taxRateLabel').textContent = appData.settings.taxRate;
            
            // Guardar datos
            saveAppData();
            
            // Mostrar mensaje de éxito
            alert('Configuración guardada correctamente');
        }
        
        // =============================================
        // FUNCIONES DE CLIENTES
        // =============================================
        
        // Mostrar modal de nuevo cliente
        function showNewClientModal() {
            const modal = new bootstrap.Modal(document.getElementById('newClientModal'));
            document.getElementById('client-form').reset();
            modal.show();
        }
        
        // Guardar cliente
        function saveClient() {
            const form = document.getElementById('client-form');
            if(!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }
            
            const newClient = {
                id: appData.clients.length > 0 ? Math.max(...appData.clients.map(c => c.id)) + 1 : 1,
                name: document.getElementById('clientName').value,
                identification: document.getElementById('clientId').value,
                phone: document.getElementById('clientPhone').value,
                email: document.getElementById('clientEmail').value,
                address: document.getElementById('clientAddress').value
            };
            
            appData.clients.push(newClient);
            saveAppData();
            loadClients();
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('newClientModal'));
            modal.hide();
            
            alert('Cliente guardado correctamente');
        }
        
        // Ver cliente
        function viewClient(id) {
            const client = appData.clients.find(c => c.id === id);
            if(client) {
                alert(`Nombre: ${client.name}\nIdentificación: ${client.identification}\nTeléfono: ${client.phone}\nEmail: ${client.email}\nDirección: ${client.address}`);
            }
        }
        
        // Editar cliente
        function editClient(id) {
            const client = appData.clients.find(c => c.id === id);
            if(client) {
                document.getElementById('clientName').value = client.name;
                document.getElementById('clientId').value = client.identification;
                document.getElementById('clientPhone').value = client.phone;
                document.getElementById('clientEmail').value = client.email;
                document.getElementById('clientAddress').value = client.address;
                
                const modal = new bootstrap.Modal(document.getElementById('newClientModal'));
                modal.show();
                
                // Cambiar el botón de guardar para que actualice en lugar de crear
                const saveBtn = document.querySelector('#newClientModal .modal-footer .btn-primary');
                saveBtn.textContent = 'Actualizar Cliente';
                saveBtn.onclick = function() {
                    updateClient(id);
                };
            }
        }
        
        // Actualizar cliente
        function updateClient(id) {
            const form = document.getElementById('client-form');
            if(!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }
            
            const clientIndex = appData.clients.findIndex(c => c.id === id);
            if(clientIndex !== -1) {
                appData.clients[clientIndex] = {
                    id: id,
                    name: document.getElementById('clientName').value,
                    identification: document.getElementById('clientId').value,
                    phone: document.getElementById('clientPhone').value,
                    email: document.getElementById('clientEmail').value,
                    address: document.getElementById('clientAddress').value
                };
                
                saveAppData();
                loadClients();
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('newClientModal'));
                modal.hide();
                
                alert('Cliente actualizado correctamente');
            }
        }
        
        // Eliminar cliente
        function deleteClient(id) {
            if(confirm('¿Estás seguro de que deseas eliminar este cliente?')) {
                appData.clients = appData.clients.filter(c => c.id !== id);
                saveAppData();
                loadClients();
                alert('Cliente eliminado correctamente');
            }
        }
        
        // =============================================
        // FUNCIONES DE PRODUCTOS
        // =============================================
        
        // Mostrar modal de nuevo producto
        function showNewProductModal() {
            const modal = new bootstrap.Modal(document.getElementById('newProductModal'));
            document.getElementById('product-form').reset();
            modal.show();
        }
        
        // Guardar producto
        function saveProduct() {
            const form = document.getElementById('product-form');
            if(!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }
            
            const newProduct = {
                id: appData.products.length > 0 ? Math.max(...appData.products.map(p => p.id)) + 1 : 1,
                code: document.getElementById('productCode').value,
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseFloat(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                description: document.getElementById('productDescription').value
            };
            
            appData.products.push(newProduct);
            saveAppData();
            loadProducts();
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('newProductModal'));
            modal.hide();
            
            alert('Producto guardado correctamente');
        }
        
        // Ver producto
        function viewProduct(id) {
            const product = appData.products.find(p => p.id === id);
            if(product) {
                alert(`Código: ${product.code}\nNombre: ${product.name}\nCategoría: ${product.category}\nPrecio: $${product.price.toFixed(2)}\nStock: ${product.stock}\nDescripción: ${product.description}`);
            }
        }
        
        // Editar producto
        function editProduct(id) {
            const product = appData.products.find(p => p.id === id);
            if(product) {
                document.getElementById('productCode').value = product.code;
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productDescription').value = product.description;
                
                const modal = new bootstrap.Modal(document.getElementById('newProductModal'));
                modal.show();
                
                // Cambiar el botón de guardar para que actualice en lugar de crear
                const saveBtn = document.querySelector('#newProductModal .modal-footer .btn-primary');
                saveBtn.textContent = 'Actualizar Producto';
                saveBtn.onclick = function() {
                    updateProduct(id);
                };
            }
        }
        
        // Actualizar producto
        function updateProduct(id) {
            const form = document.getElementById('product-form');
            if(!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }
            
            const productIndex = appData.products.findIndex(p => p.id === id);
            if(productIndex !== -1) {
                appData.products[productIndex] = {
                    id: id,
                    code: document.getElementById('productCode').value,
                    name: document.getElementById('productName').value,
                    category: document.getElementById('productCategory').value,
                    price: parseFloat(document.getElementById('productPrice').value),
                    stock: parseInt(document.getElementById('productStock').value),
                    description: document.getElementById('productDescription').value
                };
                
                saveAppData();
                loadProducts();
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('newProductModal'));
                modal.hide();
                
                alert('Producto actualizado correctamente');
            }
        }
        
        // Eliminar producto
        function deleteProduct(id) {
            if(confirm('¿Estás seguro de que deseas eliminar este producto?')) {
                appData.products = appData.products.filter(p => p.id !== id);
                saveAppData();
                loadProducts();
                alert('Producto eliminado correctamente');
            }
        }
        
        // =============================================
        // FUNCIONES DE FACTURAS
        // =============================================
        
        // Mostrar formulario de nueva factura
        function showCreateInvoice() {
            // Generar número de factura
            const nextNum = appData.settings.nextInvoiceNumber;
            const invoiceNumber = `${appData.settings.invoicePrefix}-${new Date().getFullYear()}-${nextNum.toString().padStart(3, '0')}`;
            document.getElementById('invoiceNumber').value = invoiceNumber;
            
            // Establecer fecha actual
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('invoiceDate').value = today;
            
            // Calcular fecha de vencimiento (15 días por defecto)
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 15);
            document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
            
            // Limpiar items
            document.getElementById('invoiceItemsTable').getElementsByTagName('tbody')[0].innerHTML = '';
            
            // Mostrar sección
            showSection('create-invoice');
            
            // Agregar primera fila de producto
            addInvoiceItem();
        }
        
        // Agregar item a la factura
        function addInvoiceItem() {
            const table = document.getElementById('invoiceItemsTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.className = 'invoice-item-row';
            newRow.innerHTML = `
                <td>
                    <select class="form-select product-select" onchange="updateProductPrice(this)">
                        <option value="" selected disabled>Seleccionar producto...</option>
                        ${appData.products.map(p => `<option value="${p.id}">${p.name} ($${p.price.toFixed(2)})</option>`).join('')}
                    </select>
                </td>
                <td>
                    <input type="number" class="form-control quantity" value="1" min="1" onchange="calculateInvoiceTotal()">
                </td>
                <td>
                    <input type="number" class="form-control price" value="0.00" min="0" step="0.01" onchange="calculateInvoiceTotal()">
                </td>
                <td>
                    <input type="number" class="form-control discount" value="0.00" min="0" max="100" step="0.01" onchange="calculateInvoiceTotal()">
                </td>
                <td class="item-total">$0.00</td>
                <td>
                    <button class="btn btn-sm btn-danger" onclick="removeInvoiceItem(this)">
                        <i class="bi bi-trash"></i>
                    </button>
                </td>
            `;
            
            calculateInvoiceTotal();
        }
        
        // Actualizar precio cuando se selecciona un producto
        function updateProductPrice(select) {
            if(select.value) {
                const product = appData.products.find(p => p.id === parseInt(select.value));
                if(product) {
                    const row = select.closest('tr');
                    row.querySelector('.price').value = product.price.toFixed(2);
                    calculateInvoiceTotal();
                }
            }
        }
        
        // Eliminar item de la factura
        function removeInvoiceItem(button) {
            const row = button.closest('tr');
            row.remove();
            calculateInvoiceTotal();
        }
        
        // Calcular total de la factura
        function calculateInvoiceTotal() {
            let subtotal = 0;
            let totalDiscount = 0;
            
            document.querySelectorAll('#invoiceItemsTable tbody tr').forEach(row => {
                const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
                const price = parseFloat(row.querySelector('.price').value) || 0;
                const discount = parseFloat(row.querySelector('.discount').value) || 0;
                
                const itemTotal = quantity * price;
                const itemDiscount = itemTotal * (discount / 100);
                const itemSubtotal = itemTotal - itemDiscount;
                
                subtotal += itemSubtotal;
                totalDiscount += itemDiscount;
                
                row.querySelector('.item-total').textContent = `$${itemSubtotal.toFixed(2)}`;
            });
            
            const taxRate = appData.settings.taxRate;
            const taxes = subtotal * (taxRate / 100);
            const total = subtotal + taxes;
            
            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('totalDiscount').textContent = `$${totalDiscount.toFixed(2)}`;
            document.getElementById('taxes').textContent = `$${taxes.toFixed(2)}`;
            document.getElementById('invoiceTotal').textContent = `$${total.toFixed(2)}`;
        }
        
        // Guardar factura
        function saveInvoice() {
            const form = document.getElementById('invoice-form');
            if(!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }
            
            // Verificar que haya al menos un item
            const items = [];
            document.querySelectorAll('#invoiceItemsTable tbody tr').forEach(row => {
                const productSelect = row.querySelector('.product-select');
                if(productSelect.value) {
                    items.push({
                        productId: parseInt(productSelect.value),
                        quantity: parseFloat(row.querySelector('.quantity').value),
                        price: parseFloat(row.querySelector('.price').value),
                        discount: parseFloat(row.querySelector('.discount').value)
                    });
                }
            });
            
            if(items.length === 0) {
                alert('Debe agregar al menos un producto a la factura');
                return;
            }
            
            // Calcular total
            calculateInvoiceTotal();
            const total = parseFloat(document.getElementById('invoiceTotal').textContent.replace('$', ''));
            
            // Crear nueva factura
            const newInvoice = {
                id: appData.invoices.length > 0 ? Math.max(...appData.invoices.map(i => i.id)) + 1 : 1,
                number: document.getElementById('invoiceNumber').value,
                date: document.getElementById('invoiceDate').value,
                dueDate: document.getElementById('dueDate').value,
                clientId: parseInt(document.getElementById('clientSelect').value),
                items: items,
                notes: document.getElementById('notes').value,
                terms: document.getElementById('terms').value,
                status: 'pending',
                total: total
            };
            
            appData.invoices.push(newInvoice);
            
            // Incrementar número de factura
            appData.settings.nextInvoiceNumber++;
            
            saveAppData();
            loadInvoices();
            showSection('facturas');
            
            alert('Factura guardada correctamente');
        }
        
        // Ver factura
        function viewInvoice(id) {
            const invoice = appData.invoices.find(i => i.id === id);
            if(invoice) {
                const client = appData.clients.find(c => c.id === invoice.clientId);
                
                let itemsText = '';
                invoice.items.forEach(item => {
                    const product = appData.products.find(p => p.id === item.productId);
                    itemsText += `\n- ${product ? product.name : 'Producto no encontrado'}: ${item.quantity} x $${item.price.toFixed(2)} (Desc: ${item.discount}%) = $${(item.quantity * item.price * (1 - item.discount/100)).toFixed(2)}`;
                });
                
                alert(`Factura: ${invoice.number}\nCliente: ${client ? client.name : 'Cliente no encontrado'}\nFecha: ${formatDate(invoice.date)}\nVencimiento: ${formatDate(invoice.dueDate)}\nEstado: ${invoice.status === 'paid' ? 'Pagada' : 'Pendiente'}\n\nItems:${itemsText}\n\nSubtotal: $${(invoice.total / (1 + appData.settings.taxRate/100)).toFixed(2)}\nImpuestos (${appData.settings.taxRate}%): $${(invoice.total - (invoice.total / (1 + appData.settings.taxRate/100))).toFixed(2)}\nTotal: $${invoice.total.toFixed(2)}\n\nNotas: ${invoice.notes}\nTérminos: ${invoice.terms}`);
            }
        }
        
        // Editar factura
        function editInvoice(id) {
            const invoice = appData.invoices.find(i => i.id === id);
            if(invoice) {
                // Mostrar formulario de factura
                showCreateInvoice();
                
                // Llenar datos básicos
                document.getElementById('invoiceNumber').value = invoice.number;
                document.getElementById('invoiceDate').value = invoice.date;
                document.getElementById('dueDate').value = invoice.dueDate;
                document.getElementById('clientSelect').value = invoice.clientId;
                document.getElementById('notes').value = invoice.notes;
                document.getElementById('terms').value = invoice.terms;
                
                // Limpiar items y agregar los de la factura
                const table = document.getElementById('invoiceItemsTable').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                invoice.items.forEach(item => {
                    const product = appData.products.find(p => p.id === item.productId);
                    if(product) {
                        const newRow = table.insertRow();
                        newRow.className = 'invoice-item-row';
                        newRow.innerHTML = `
                            <td>
                                <select class="form-select product-select" onchange="updateProductPrice(this)">
                                    <option value="" disabled>Seleccionar producto...</option>
                                    ${appData.products.map(p => `<option value="${p.id}" ${p.id === product.id ? 'selected' : ''}>${p.name} ($${p.price.toFixed(2)})</option>`).join('')}
                                </select>
                            </td>
                            <td>
                                <input type="number" class="form-control quantity" value="${item.quantity}" min="1" onchange="calculateInvoiceTotal()">
                            </td>
                            <td>
                                <input type="number" class="form-control price" value="${item.price.toFixed(2)}" min="0" step="0.01" onchange="calculateInvoiceTotal()">
                            </td>
                            <td>
                                <input type="number" class="form-control discount" value="${item.discount}" min="0" max="100" step="0.01" onchange="calculateInvoiceTotal()">
                            </td>
                            <td class="item-total">$${(item.quantity * item.price * (1 - item.discount/100)).toFixed(2)}</td>
                            <td>
                                <button class="btn btn-sm btn-danger" onclick="removeInvoiceItem(this)">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        `;
                    }
                });
                
                // Calcular total
                calculateInvoiceTotal();
                
                // Cambiar el botón de guardar para que actualice en lugar de crear
                const saveBtn = document.querySelector('#create-invoice .btn-success');
                saveBtn.textContent = 'Actualizar Factura';
                saveBtn.onclick = function() {
                    updateInvoice(id);
                };
            }
        }
        
        // Actualizar factura
        function updateInvoice(id) {
            const form = document.getElementById('invoice-form');
            if(!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }
            
            // Verificar que haya al menos un item
            const items = [];
            document.querySelectorAll('#invoiceItemsTable tbody tr').forEach(row => {
                const productSelect = row.querySelector('.product-select');
                if(productSelect.value) {
                    items.push({
                        productId: parseInt(productSelect.value),
                        quantity: parseFloat(row.querySelector('.quantity').value),
                        price: parseFloat(row.querySelector('.price').value),
                        discount: parseFloat(row.querySelector('.discount').value)
                    });
                }
            });
            
            if(items.length === 0) {
                alert('Debe agregar al menos un producto a la factura');
                return;
            }
            
            // Calcular total
            calculateInvoiceTotal();
            const total = parseFloat(document.getElementById('invoiceTotal').textContent.replace('$', ''));
            
            // Actualizar factura
            const invoiceIndex = appData.invoices.findIndex(i => i.id === id);
            if(invoiceIndex !== -1) {
                appData.invoices[invoiceIndex] = {
                    id: id,
                    number: document.getElementById('invoiceNumber').value,
                    date: document.getElementById('invoiceDate').value,
                    dueDate: document.getElementById('dueDate').value,
                    clientId: parseInt(document.getElementById('clientSelect').value),
                    items: items,
                    notes: document.getElementById('notes').value,
                    terms: document.getElementById('terms').value,
                    status: appData.invoices[invoiceIndex].status,
                    total: total
                };
                
                saveAppData();
                loadInvoices();
                showSection('facturas');
                
                alert('Factura actualizada correctamente');
            }
        }
        
        // Eliminar factura
        function deleteInvoice(id) {
            if(confirm('¿Estás seguro de que deseas eliminar esta factura?')) {
                appData.invoices = appData.invoices.filter(i => i.id !== id);
                saveAppData();
                loadInvoices();
                alert('Factura eliminada correctamente');
            }
        }
        
        // Imprimir factura
        function printInvoice() {
            // Crear contenido para imprimir
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            const clientSelect = document.getElementById('clientSelect');
            const client = appData.clients.find(c => c.id === parseInt(clientSelect.value));
            
            let itemsHtml = '';
            document.querySelectorAll('#invoiceItemsTable tbody tr').forEach(row => {
                const productSelect = row.querySelector('.product-select');
                if(productSelect.value) {
                    const product = appData.products.find(p => p.id === parseInt(productSelect.value));
                    const quantity = row.querySelector('.quantity').value;
                    const price = parseFloat(row.querySelector('.price').value).toFixed(2);
                    const discount = row.querySelector('.discount').value;
                    const total = row.querySelector('.item-total').textContent;
                    
                    itemsHtml += `
                        <tr>
                            <td>${product ? product.name : 'Producto no encontrado'}</td>
                            <td>${quantity}</td>
                            <td>$${price}</td>
                            <td>${discount}%</td>
                            <td>${total}</td>
                        </tr>
                    `;
                }
            });
            
            const subtotal = document.getElementById('subtotal').textContent;
            const taxes = document.getElementById('taxes').textContent;
            const invoiceTotal = document.getElementById('invoiceTotal').textContent;
            
            const printContent = `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto;">
                    <h2 style="text-align: center; color: var(--primary-color);">Gente de Hoy Contables</h2>
                    <p style="text-align: center;">${appData.settings.address} | ${appData.settings.phone} | ${appData.settings.email}</p>
                    <hr>
                    <h3 style="text-align: center;">Factura ${invoiceNumber}</h3>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <div>
                            <p><strong>Fecha:</strong> ${document.getElementById('invoiceDate').value}</p>
                            <p><strong>Vencimiento:</strong> ${document.getElementById('dueDate').value}</p>
                        </div>
                        <div>
                            <p><strong>Cliente:</strong> ${client ? client.name : 'Cliente no encontrado'}</p>
                            <p><strong>Identificación:</strong> ${client ? client.identification : ''}</p>
                        </div>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <thead>
                            <tr style="background-color: #f8f9fa;">
                                <th style="padding: 8px; border: 1px solid #ddd;">Producto</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">Cantidad</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">Precio</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">Descuento</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHtml}
                        </tbody>
                    </table>
                    <div style="text-align: right; margin-bottom: 20px;">
                        <p><strong>Subtotal:</strong> ${subtotal}</p>
                        <p><strong>Impuestos (${appData.settings.taxRate}%):</strong> ${taxes}</p>
                        <p><strong>Total:</strong> ${invoiceTotal}</p>
                    </div>
                    <div style="margin-top: 30px;">
                        <p><strong>Notas:</strong> ${document.getElementById('notes').value}</p>
                        <p><strong>Términos y condiciones:</strong> ${document.getElementById('terms').value}</p>
                    </div>
                </div>
            `;
            
            // Abrir ventana de impresión
            const printWindow = window.open('', '_blank');
            printWindow.document.open();
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Factura ${invoiceNumber}</title>
                        <style>
                            @media print {
                                body { -webkit-print-color-adjust: exact; }
                            }
                        </style>
                    </head>
                    <body onload="window.print(); window.close();">
                        ${printContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
        }
        
        // =============================================
        // FUNCIONES DE REPORTES Y EXPORTACIÓN
        // =============================================
        
        // Exportar a PDF
        function exportToPDF(elementId, filename) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Agregar título
            doc.setFontSize(18);
            doc.text('Gente de Hoy Contables', 105, 15, { align: 'center' });
            doc.setFontSize(12);
            doc.text('Reporte generado el ' + new Date().toLocaleDateString(), 105, 22, { align: 'center' });
            
            // Agregar contenido HTML como imagen
            doc.html(document.getElementById(elementId), {
                callback: function(doc) {
                    doc.save(filename);
                },
                margin: [20, 10, 10, 10],
                autoPaging: 'text',
                width: 180,
                windowWidth: document.getElementById(elementId).scrollWidth
            });
        }
        
        // Exportar a Excel
        function exportToExcel(elementId, filename) {
            const table = document.getElementById(elementId);
            const workbook = XLSX.utils.table_to_book(table);
            XLSX.writeFile(workbook, filename);
        }
        
        // Imprimir elemento
        function printElement(elementId) {
            const printContent = document.getElementById(elementId).outerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = printContent;
            window.print();
            document.body.innerHTML = originalContent;
            
            // Recargar la aplicación
            showMainApp();
        }
        
        // =============================================
        // FUNCIONES DE GRÁFICOS
        // =============================================
        
        // Inicializar gráficos del dashboard
        function initDashboardCharts() {
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            
            // Datos para el gráfico (últimos 6 meses)
            const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'];
            const salesData = [0, 0, 0, 0, 0, 0];
            
            appData.invoices.forEach(invoice => {
                const month = new Date(invoice.date).getMonth();
                if(month >= 0 && month < 6) {
                    salesData[month] += invoice.total;
                }
            });
            
            new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Ventas 2023',
                        data: salesData,
                        backgroundColor: 'rgba(78, 115, 223, 0.05)',
                        borderColor: 'rgba(78, 115, 223, 1)',
                        pointBackgroundColor: 'rgba(78, 115, 223, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(78, 115, 223, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Inicializar gráficos de reportes
        function initReportCharts() {
            // Gráfico de ventas mensuales
            const monthlySalesCtx = document.getElementById('monthlySalesChart').getContext('2d');
            const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio'];
            const salesData = [0, 0, 0, 0, 0, 0];
            
            appData.invoices.forEach(invoice => {
                const month = new Date(invoice.date).getMonth();
                if(month >= 0 && month < 6) {
                    salesData[month] += invoice.total;
                }
            });
            
            new Chart(monthlySalesCtx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Ventas',
                        data: salesData,
                        backgroundColor: 'rgba(78, 115, 223, 0.7)',
                        borderColor: 'rgba(78, 115, 223, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Gráfico de productos más vendidos (top 5)
            const topProductsCtx = document.getElementById('topProductsChart').getContext('2d');
            
            // Contar productos vendidos
            const productSales = {};
            appData.invoices.forEach(invoice => {
                invoice.items.forEach(item => {
                    if(!productSales[item.productId]) {
                        productSales[item.productId] = 0;
                    }
                    productSales[item.productId] += item.quantity;
                });
            });
            
            // Convertir a array y ordenar
            const topProducts = Object.entries(productSales)
                .map(([productId, quantity]) => {
                    const product = appData.products.find(p => p.id === parseInt(productId));
                    return {
                        name: product ? product.name : `Producto ${productId}`,
                        quantity: quantity
                    };
                })
                .sort((a, b) => b.quantity - a.quantity)
                .slice(0, 5);
            
            new Chart(topProductsCtx, {
                type: 'doughnut',
                data: {
                    labels: topProducts.map(p => p.name),
                    datasets: [{
                        data: topProducts.map(p => p.quantity),
                        backgroundColor: [
                            'rgba(78, 115, 223, 0.7)',
                            'rgba(28, 200, 138, 0.7)',
                            'rgba(231, 74, 59, 0.7)',
                            'rgba(246, 194, 62, 0.7)',
                            'rgba(153, 102, 255, 0.7)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // =============================================
        // FUNCIONES DE TUTORIAL
        // =============================================
        
        // Mostrar tutorial
        function showTutorial() {
            const tutorialSteps = [
                {
                    title: "Bienvenido a Gente de Hoy Contables",
                    text: "Este sistema te ayudará a gestionar tus facturas, clientes y productos de manera eficiente."
                },
                {
                    title: "Dashboard",
                    text: "En el dashboard encontrarás un resumen de tus ventas, clientes y productos."
                },
                {
                    title: "Facturas",
                    text: "En la sección de facturas puedes crear, editar y eliminar facturas, así como imprimirlas o exportarlas."
                },
                {
                    title: "Clientes",
                    text: "Gestiona tu lista de clientes, agrega nuevos o edita los existentes."
                },
                {
                    title: "Productos",
                    text: "Mantén un catálogo actualizado de tus productos o servicios."
                },
                {
                    title: "Reportes",
                    text: "Genera reportes de ventas y exporta tus datos en diferentes formatos."
                },
                {
                    title: "Configuración",
                    text: "Personaliza la información de tu empresa y preferencias de facturación."
                },
                {
                    title: "¡Listo para comenzar!",
                    text: "Ahora estás listo para usar todas las funciones del sistema. ¡Empieza a facturar!"
                }
            ];
            
            let currentStep = 0;
            const tutorialOverlay = document.getElementById('tutorial-overlay');
            const tutorialTitle = document.getElementById('tutorial-title');
            const tutorialText = document.getElementById('tutorial-text');
            const prevBtn = document.getElementById('prev-tutorial');
            const nextBtn = document.getElementById('next-tutorial');
            const skipBtn = document.getElementById('skip-tutorial');
            
            function updateTutorial() {
                tutorialTitle.textContent = tutorialSteps[currentStep].title;
                tutorialText.textContent = tutorialSteps[currentStep].text;
                
                prevBtn.disabled = currentStep === 0;
                
                if(currentStep === tutorialSteps.length - 1) {
                    nextBtn.style.display = 'none';
                    skipBtn.style.display = 'block';
                } else {
                    nextBtn.style.display = 'block';
                    skipBtn.style.display = 'none';
                }
            }
            
            prevBtn.onclick = function() {
                if(currentStep > 0) {
                    currentStep--;
                    updateTutorial();
                }
            };
            
            nextBtn.onclick = function() {
                if(currentStep < tutorialSteps.length - 1) {
                    currentStep++;
                    updateTutorial();
                }
            };
            
            skipBtn.onclick = function() {
                tutorialOverlay.style.display = 'none';
            };
            
            tutorialOverlay.style.display = 'flex';
            updateTutorial();
        }
        
        // =============================================
        // FUNCIONES UTILITARIAS
        // =============================================
        
        // Formatear fecha
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('es-ES', options);
        }
        
        // Guardar datos de la aplicación
        function saveAppData() {
            localStorage.setItem('facturacionData', JSON.stringify(appData));
        }
        
        // Configurar event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // Validación simple (en un sistema real usarías autenticación segura)
                if(username && password) {
                    appData.currentUser = { username: username };
                    document.getElementById('logged-user').textContent = username;
                    showMainApp();
                } else {
                    alert('Por favor ingresa usuario y contraseña');
                }
            });
            
            // Configuración de empresa
            document.getElementById('company-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveSettings();
            });
            
            // Configuración de facturación
            document.getElementById('billing-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveSettings();
            });
        }
        
        // Inicializar la aplicación cuando se carga la página
        window.onload = initApp;
    </script>
</body>
</html>